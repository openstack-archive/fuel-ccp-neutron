dsl_version: 0.1.0
service:
  name: opendaylight
  ports:
    - {{ opendaylight.api_port }}
    - {{ opendaylight.ovs_port }}
    - {{ opendaylight.openflow_port1 }}
    - {{ opendaylight.openflow_port2 }}
    - {{ opendaylight.dlux_port }}
  containers:
    - name: opendaylight
      image: opendaylight
      probes:
        readiness:
          type: exec
          command: /usr/local/bin/odl-wait-boot.sh
      volumes:
        - name: ovs-socket
          type: host
          path: /run/openvswitch
      daemon:
        command: ./bin/karaf
        files:
          - odl-wait-boot.sh
          - org.apache.karaf.features.cfg
          - org.ops4j.pax.logging.cfg
      post:
        - name: odl-set-admin-password
          type: single
          command: /tmp/odl-set-admin-password.sh
          files:
            - odl-set-admin-password.sh

files:
  odl-wait-boot.sh:
    path: /usr/local/bin/odl-wait-boot.sh
    content: odl-wait-boot.sh.j2
    perm: "0755"
  odl-set-admin-password.sh:
    path: /tmp/odl-set-admin-password.sh
    content: odl-set-admin-password.sh.j2
    perm: "0755"
  org.apache.karaf.features.cfg:
    path: /odl/etc/org.apache.karaf.features.cfg
    content: org.apache.karaf.features.cfg.j2
    perm: "0600"
  org.ops4j.pax.logging.cfg:
    path: /odl/etc/org.ops4j.pax.logging.cfg
    content: org.ops4j.pax.logging.cfg.j2
    perm: "0600"
